# 混淆

### 混淆就是把代码变得难以阅读，让怀有恶意目的的人很难通过代码理清逻辑，但是不能改变执行的结果。要做等价转换

### 这种转换包括两方面

    1. 名字转换。变量名、函数名这些我们会注意命名要有含义，但是编译后的代码就不需要了，可以把各种 identifier 的 name 重命名为没有含义的 abcd，修改作用域中某个变量的名字，同时还要修改用到它的地方，这个可以通过 path.scope.rename 的 api

    2. 逻辑转换。if 的逻辑可以用 switch 来代替，for 的逻辑可以用 while 来代替，这都是等价的，把一种方式实现的代码转成另一种等价的形式就可以达到混淆的目的。做混淆工具主要是要找到这种等价的变化，而且后者一定要特别复杂难以分析，然后实现这种转换，就达到了混淆的目的

### 目的是为了找出所有的声明，那就要遍历所有会生成作用域的节点，包括 FunctionDeclaration、BlockStatement 等，而这些节点有一个别名，叫 Scopable，然后对每一个声明（binding）都重命名为无意义的名字，并且更新所有引用这个声明的地方，这个逻辑在 path.scope.rename 已经实现了，直接调用这个 api 即可

### 然后就是替换所有的声明（binding） 的名字了：

### 首先取出 path.scope.bindings，遍历每一个 binding，然后通过 rename 的 api 来进行改名。

### 并且处理过后的声明加个标记，再次处理到的时候就跳过。




# 压缩

### 压缩就是要去掉代码中执行不到的部分，比如 return 语句后的一些语句和没有意义的部分，包括注释、换行等，基于 AST 的转换做压缩要处理的情况特别多，这里我们只实现两种情况的压缩：

    1. 删除 return 之后的不会执行到的语句
    2. 删除没有被使用的变量声明（死代码删除 Dead Code Elemation，简称 DCE）



### 删除 return 之后的语句

    1. 思路分析

    删除 return 之后的语句，就是要找到函数声明 FunctionDeclaration 的函数体，遍历一遍 body 的 AST，如果是 return 之后就打个标记之后删除
    但是要注意，return 之后是可以有函数声明的，会做变量提升，还有如果是 var 声明的变量，也会做提升，所以要去掉这两种情况

    2. 代码实现

    拿到 BlockStatement 的 body 中的每一个节点，如果是在 return、throw 等语句之后，就准备删除，但是要排除函数声明语句和 var 的变量声明语句